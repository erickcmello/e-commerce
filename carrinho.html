<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carrinho</title>

    <link rel="stylesheet" href="style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  </head>

  <body class="d-flex flex-column">


    <!--estrutura do cabecalho-->
    <header class="header">
      <!-- <div>
        <span><h1>E-commerce</h1></span>
      </div> -->
      <div class="conteiner">
        <span onclick="window.location.href = 'index.html';" class="material-symbols-outlined"> home </span>
        <div class="dropdown">
          <a href="#"
              class=" material-symbols-outlined "
            >
              shopping_cart_checkout 
         </a>
            <ul class="dropdown-menu bg-muted p-3" id="produto-cardcar" >
              <!-- <li>
                <a class="dropdown-item" href="#">...</a>
              </li>
              <li>
                <a class="dropdown-item" href="#">...</a>
              </li> -->
            </ul>
          </li>
        </ul>
        </div>
        
      </div>
    </header>

    <main class="container my-5">
      <h2 class="mb-4">Meu Carrinho</h2>

      <div class="row">
        <!-- LISTA DE PRODUTOS -->
        <div class="col-lg-8">
          <div id="lista-carrinho"></div>
        </div>

        <!-- RESUMO -->
        <div class="col-lg-4">
          <div class="p-3 border rounded bg-white shadow-sm">
            <h4>Resumo do Pedido</h4>

            <div class="d-flex justify-content-between mt-3">
              <span>Subtotal:</span>
              <strong id="subtotal">R$ 0,00</strong>
            </div>

            <div class="d-flex justify-content-between mt-2">
              <span>Frete:</span>
              <strong id="frete">R$ 0,00</strong>
            </div>

            <hr />

            <div class="d-flex justify-content-between">
              <span><strong>Total:</strong></span>
              <strong id="total" class="text-success">R$ 0,00</strong>
            </div>

            <button class="btn-comp w-100 mt-4" data-bs-toggle="modal" data-bs-target="#staticBackdrop">Finalizar Compra</button>
          </div>
        </div>
      </div>
    </main>


    <!-- Modal -->
    <div
      class="modal fade"
      id="staticBackdrop"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
      tabindex="-1"
      aria-labelledby="staticBackdropLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="staticBackdropLabel">Pagamento</h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body d-flex flex-column justify-content-md-center">
            <!-- qr code -->
            <h2 class="d-flex justify-content-md-center">Pix</h2>
            <!-- <button id="gerarBtn"></button> -->
            <img id="qrcode" src="" alt="seu qrcode aqui" />
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Voltar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!--estrutura rodapé-->
    <footer class="footer-custom border-top mt-5">
      <div class="footer-container">

        <!-- Esquerda -->
        <div class="footer-left">
          <p>Página inicial</p>
          <p>Contato</p>
        </div>

        <!-- Direita -->
        <div class="footer-right">
          <p class="titulo-loja">LOJA física<br>em Porto Alegre</p>
          <div id="mapa" class="mapa-footer"></div>
        </div>

      </div>

      <!-- Texto inferior -->
      <div class="footer-bottom">
        Todos Direitos Reservados
      </div>
    </footer>



    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>

    <script src="script.js"></script>

    <script>
      // Recuperar itens do carrinho do script.js
      let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];

      function atualizarCarrinhoPagina() {
        const lista = document.getElementById("lista-carrinho");
        const subtotalEl = document.getElementById("subtotal");
        const totalEl = document.getElementById("total");
        const freteEl = document.getElementById("frete");

        if (carrinho.length === 0) {
          lista.innerHTML = "<h5>Seu carrinho está vazio.</h5>";
          subtotalEl.textContent = "R$ 0,00";
          freteEl.textContent = "R$ 0,00";
          totalEl.textContent = "R$ 0,00";
          return;
        }

        lista.innerHTML = carrinho
          .map(
            (item, index) => `
          <div class="d-flex align-items-center border rounded p-3 mb-3 bg-white shadow-sm">
            <img src="${item.thumbnail}" width="80" class="me-3 rounded">
            
            <div class="flex-grow-1">
              <h5 class="mb-1">${item.title}</h5>
              <p class="text-success fw-bold mb-1">R$ ${item.price}</p>

              <div class="d-flex align-items-center gap-2">
                <button class="btn btn-sm btn-outline-secondary" onclick="alterarQtd(${index}, -1)">-</button>
                <span class="fw-bold">${item.qtd}</span>
                <button class="btn btn-sm btn-outline-secondary" onclick="alterarQtd(${index}, 1)">+</button>
              </div>
            </div>

            <button class="btn btn-danger ms-3" onclick="removerItem(${index})">
              Remover
            </button>
          </div>
        `
          )
          .join("");

        // Cálculo subtotal
        let subtotal = carrinho.reduce(
          (sum, item) => sum + item.price * item.qtd,
          0
        );
        let frete = subtotal > 0 ? 0 : 0;
        let total = subtotal + frete;

        subtotalEl.textContent = "R$ " + subtotal.toFixed(2);
        freteEl.textContent = "R$ " + frete.toFixed(2);
        totalEl.textContent = "R$ " + total.toFixed(2);
      }

      function alterarQtd(index, valor) {
        if (carrinho[index].qtd + valor <= 0) return;
        carrinho[index].qtd += valor;
        salvarCarrinho();
      }

      function removerItem(index) {
        carrinho.splice(index, 1);
        salvarCarrinho();
      }

      function salvarCarrinho() {
        localStorage.setItem("carrinho", JSON.stringify(carrinho));
        atualizarCarrinhoPagina();
      }

      atualizarCarrinhoPagina();
    </script>
  </body>
</html>
